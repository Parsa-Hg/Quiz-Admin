<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø¢Ø²Ù…ÙˆÙ† (Admin)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #F2F2F7; --card: #FFFFFF; --text: #000000;
            --sub-text: #8A8A8E; --blue: #007AFF; --border: #C6C6C8;
        }
        body.dark-mode {
            --bg: #000000; --card: #1C1C1E; --text: #FFFFFF;
            --sub-text: #98989F; --blue: #0A84FF; --border: #38383A;
        }
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Tahoma, sans-serif;
            background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; transition: 0.3s;
        }
        .container { max-width: 500px; margin: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .card { background: var(--card); border-radius: 18px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        
        input, textarea {
            width: 100%; padding: 15px; border-radius: 12px; border: 1px solid var(--border);
            background: var(--bg); color: var(--text); margin-bottom: 10px; font-family: inherit;
        }
        
        .q-box { border-right: 4px solid var(--blue); padding-right: 15px; margin-bottom: 25px; }
        
        .btn {
            width: 100%; padding: 16px; border-radius: 14px; border: none;
            font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.2s;
        }
        .btn-blue { background: var(--blue); color: white; margin-top: 10px; }
        .btn-outline { background: transparent; border: 2px solid var(--blue); color: var(--blue); margin-top: 20px; }
        
        .link-display {
            background: var(--bg); padding: 15px; border-radius: 10px;
            word-break: break-all; font-family: monospace; font-size: 0.8rem;
            margin: 15px 0; border: 1px dashed var(--blue);
        }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h2>âš™ï¸ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¯Ù…ÛŒÙ†</h2>
            <button onclick="toggleTheme()" style="background:none; border:none; color:var(--blue); font-size:1.5rem;"><i class="fas fa-moon"></i></button>
        </div>

        <div id="setup-page">
            <div class="card">
                <label>Ø¹Ù†ÙˆØ§Ù† Ú©Ù„ Ø¢Ø²Ù…ÙˆÙ†:</label>
                <input type="text" id="quiz-title" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…ÛŒØ§Ù†â€ŒØªØ±Ù… Ø§Ø¯Ø¨ÛŒØ§Øª">
            </div>

            <div id="questions-list">
                </div>

            <button class="btn btn-outline" onclick="addQuestion()">+ Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯</button>
            <button class="btn btn-blue" style="margin-top:40px;" onclick="generateFinalLink()">ğŸ”— Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</button>
        </div>

        <div id="result-page" class="hidden">
            <div class="card" style="text-align: center;">
                <i class="fas fa-check-circle" style="font-size: 4rem; color: #34C759;"></i>
                <h3>Ù„ÛŒÙ†Ú© Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!</h3>
                <p style="color:var(--sub-text)">Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ Ùˆ Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø¨ÙØ±Ø³ØªÛŒØ¯ ØªØ§ Ø¢Ø²Ù…ÙˆÙ† Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¢Ù†â€ŒÙ‡Ø§ Ø¸Ø§Ù‡Ø± Ø´ÙˆØ¯.</p>
                
                <div id="final-link" class="link-display"></div>
                
                <button class="btn btn-blue" onclick="copyToClipboard()">Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</button>
                <button class="btn btn-outline" onclick="location.reload()">Ø³Ø§Ø®Øª Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯</button>
            </div>
        </div>
    </div>

    <script>
        // ğŸ›‘ Ø§ÛŒÙ†Ø¬Ø§ Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² (Netlify) Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†:
        const STUDENT_WEB_URL = "Ø¢Ø¯Ø±Ø³_Ø³Ø§ÛŒØª_Ø¯Ø§Ù†Ø´_Ø¢Ù…ÙˆØ²_Ø±Ø§_Ø§ÛŒÙ†Ø¬Ø§_Ø¨Ú¯Ø°Ø§Ø±";

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ø³ÙˆØ§Ù„ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø±
        addQuestion();

        function addQuestion() {
            const list = document.getElementById('questions-list');
            const qNum = list.children.length + 1;
            const div = document.createElement('div');
            div.className = 'card q-box';
            div.innerHTML = `
                <h4>Ø³ÙˆØ§Ù„ ${qNum}</h4>
                <input type="text" class="q-text" placeholder="Ù…ØªÙ† Ø³ÙˆØ§Ù„...">
                <input type="number" class="q-correct" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ú¯Ø²ÛŒÙ†Ù‡ ØµØ­ÛŒØ­ (Ù…Ø«Ù„Ø§Ù‹ 1)">
                <textarea class="q-options" rows="3" placeholder="Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø± Ù‡Ø± Ø³Ø·Ø± Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ (Ø­Ø¯Ø§Ù‚Ù„ Û² Ú¯Ø²ÛŒÙ†Ù‡)"></textarea>
            `;
            list.appendChild(div);
        }

        function generateFinalLink() {
            const title = document.getElementById('quiz-title').value;
            const qCards = document.querySelectorAll('.q-box');
            const questions = [];

            if(!title) return alert("Ù„Ø·ÙØ§Ù‹ Ø¹Ù†ÙˆØ§Ù† Ø¢Ø²Ù…ÙˆÙ† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");

            qCards.forEach(card => {
                const text = card.querySelector('.q-text').value;
                const correct = card.querySelector('.q-correct').value;
                const options = card.querySelector('.q-options').value.split('\n').filter(o => o.trim() !== "");

                if(text && correct && options.length >= 2) {
                    questions.push({
                        t: text,
                        o: options,
                        c: parseInt(correct) - 1 // ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø§ÛŒÙ†Ø¯Ú©Ø³ 0
                    });
                }
            });

            if(questions.length === 0) return alert("Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ÙˆØ§Ù„ Ú©Ø§Ù…Ù„ Ø¨Ø³Ø§Ø²ÛŒØ¯");

            // Ø³Ø§Ø®Øª Ø¢Ø¨Ø¬Ú©Øª Ùˆ Ø±Ù…Ø²Ú¯Ø°Ø§Ø±ÛŒ (Base64 UTF-8)
            const dataObj = { title, questions, id: Date.now() };
            const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(dataObj))));
            
            // Ù„ÛŒÙ†Ú© Ù†Ù‡Ø§ÛŒÛŒ
            const finalURL = `${STUDENT_WEB_URL}/?data=${encoded}`;

            document.getElementById('setup-page').classList.add('hidden');
            document.getElementById('result-page').classList.remove('hidden');
            document.getElementById('final-link').innerText = finalURL;
        }

        function copyToClipboard() {
            const link = document.getElementById('final-link').innerText;
            navigator.clipboard.writeText(link).then(() => alert("Ú©Ù¾ÛŒ Ø´Ø¯!"));
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
        }
    </script>
</body>
</html>

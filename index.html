<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Quiz-Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2D65FF; --bg: #F8FAFF; --card: #FFFFFF;
            --text: #1A1C1E; --sub: #7C828A; --red: #FF3B30; --green: #34C759;
            --shadow: 0 10px 30px rgba(45, 101, 255, 0.08);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: var(--bg); color: var(--text); margin: 0; padding-bottom: 100px;
        }
        .container { max-width: 450px; margin: auto; padding: 20px; }

        /* Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        .card { background: var(--card); border-radius: 25px; padding: 20px; box-shadow: var(--shadow); margin-bottom: 20px; }
        .input-box { width: 100%; padding: 15px; border-radius: 15px; border: 1px solid #E0E7FF; background: #F9FAFB; margin-bottom: 15px; font-family: inherit; }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .btn-main { background: var(--primary); color: white; border: none; border-radius: 15px; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; }
        .btn-outline { background: none; border: 1.5px solid var(--primary); color: var(--primary); border-radius: 12px; padding: 10px; cursor: pointer; width: 100%; margin-top: 10px; }
        .btn-stop { background: var(--red); color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer; font-size: 0.8rem; }

        /* Ù„ÛŒØ³Øª Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ */
        .quiz-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #F0F4F8; }
        .quiz-item:last-child { border: none; }
        .status-badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 5px; margin-right: 5px; }
        .status-active { background: #E8F9EE; color: var(--green); }
        .status-closed { background: #FFF0F0; color: var(--red); }

        /* Ù†ÙˆØ§Ø± Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù¾Ø§ÛŒÛŒÙ† (Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ Ù…Ø«Ù„ Ø§Ù¾ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²) */
        .bottom-nav {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 450px; background: white;
            display: flex; justify-content: space-around; padding: 15px 0;
            border-radius: 25px 25px 0 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 1000;
        }
        .nav-item { border: none; background: none; color: #BDC3C7; font-size: 0.75rem; cursor: pointer; text-align: center; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 5px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="container">
        <div id="view-create">
            <h2 style="margin-bottom: 25px;">Ø³Ø§Ø®Øª Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯ ğŸ“</h2>
            <div class="card">
                <input type="text" id="quiz-title" class="input-box" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø¢Ø²Ù…ÙˆÙ† (Ù…Ø«Ù„Ø§Ù‹ Ø±ÛŒØ§Ø¶ÛŒ ÙØµÙ„ Û±)">
                <input type="number" id="quiz-time" class="input-box" placeholder="Ø²Ù…Ø§Ù† Ú©Ù„ (Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚Ù‡)">
                
                <div id="questions-container">
                    <div class="card" style="background: #F8FAFF; border: 1px dashed #C7D2FE;">
                        <input type="text" class="input-box q-text" placeholder="Ù…ØªÙ† Ø³ÙˆØ§Ù„">
                        <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û±">
                        <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û²">
                        <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û³">
                        <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û´">
                        <select class="input-box q-correct">
                            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø²ÛŒÙ†Ù‡ ØµØ­ÛŒØ­</option>
                            <option value="0">Ú¯Ø²ÛŒÙ†Ù‡ Û±</option>
                            <option value="1">Ú¯Ø²ÛŒÙ†Ù‡ Û²</option>
                            <option value="2">Ú¯Ø²ÛŒÙ†Ù‡ Û³</option>
                            <option value="3">Ú¯Ø²ÛŒÙ†Ù‡ Û´</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn-outline" onclick="addNewQuestion()">+ Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ Ø¯ÛŒÚ¯Ø±</button>
                <button class="btn-main" style="margin-top: 20px;" onclick="generateQuizLink()">Ù†Ù‡Ø§ÛŒÛŒâ€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒÙ†Ú©</button>
            </div>
            
            <div id="link-result" class="card hidden" style="background: #E0E7FF; word-break: break-all;">
                <p style="font-size: 0.8rem; font-weight: bold;">Ù„ÛŒÙ†Ú© Ø¢Ø²Ù…ÙˆÙ† Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯:</p>
                <code id="final-link" style="font-size: 0.7rem;"></code>
                <button class="btn-main" style="margin-top:10px; padding:10px;" onclick="copyLink()">Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</button>
            </div>
        </div>

        <div id="view-my-quizzes" class="hidden">
            <h2 style="margin-bottom: 25px;">Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ ğŸ—„ï¸</h2>
            <div class="card" style="padding: 0;" id="admin-quiz-list">
                </div>
        </div>

        <div id="view-students" class="hidden" style="text-align: center; padding-top: 50px;">
            <i class="fas fa-users" style="font-size: 4rem; color: #ddd;"></i>
            <h3>Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</h3>
            <p style="color: var(--sub);">Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† (Firebase) Ø¯Ø§Ø±Ø¯.</p>
        </div>

        <div id="view-profile" class="hidden" style="text-align: center; padding-top: 30px;">
            <div style="width:100px; height:100px; background:var(--primary); color:white; border-radius:50%; margin:0 auto 20px; display:flex; align-items:center; justify-content:center; font-size:3rem;">
                <i class="fas fa-user-shield"></i>
            </div>
            <h3>Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…</h3>
            <p style="color: var(--sub);">Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ Ø§Ø³ØªØ§Ø¯ Ø¹Ø²ÛŒØ²</p>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-item active" onclick="showView('view-create', this)"><i class="fas fa-plus-circle"></i>Ø³Ø§Ø®Øª</button>
        <button class="nav-item" onclick="showView('view-my-quizzes', this)"><i class="fas fa-list"></i>Ø¢Ø²Ù…ÙˆÙ†â€ŒÙ‡Ø§</button>
        <button class="nav-item" onclick="showView('view-students', this)"><i class="fas fa-user-graduate"></i>Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù†</button>
        <button class="nav-item" onclick="showView('view-profile', this)"><i class="fas fa-user-cog"></i>Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
    </div>

    <script>
        // Ø¢Ø¯Ø±Ø³ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² (Ø§ÛŒÙ† Ø±Ø§ Ø¨Ø§ Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª Ø®ÙˆØ¯Øª Ø¹ÙˆØ¶ Ú©Ù†)
        const STUDENT_APP_URL = "https://azmik-exam.liara.run/";

        let adminQuizzes = JSON.parse(localStorage.getItem('admin_quizzes')) || [];

        function showView(id, btn) {
            ['view-create', 'view-my-quizzes', 'view-students', 'view-profile'].forEach(v => {
                document.getElementById(v).classList.add('hidden');
            });
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            
            document.getElementById(id).classList.remove('hidden');
            btn.classList.add('active');
            
            if(id === 'view-my-quizzes') renderAdminQuizzes();
        }

        function addNewQuestion() {
            const container = document.getElementById('questions-container');
            const qHTML = `
                <div class="card" style="background: #F8FAFF; border: 1px dashed #C7D2FE;">
                    <input type="text" class="input-box q-text" placeholder="Ù…ØªÙ† Ø³ÙˆØ§Ù„">
                    <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û±">
                    <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û²">
                    <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û³">
                    <input type="text" class="input-box q-opt" placeholder="Ú¯Ø²ÛŒÙ†Ù‡ Û´">
                    <select class="input-box q-correct">
                        <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ú¯Ø²ÛŒÙ†Ù‡ ØµØ­ÛŒØ­</option>
                        <option value="0">Ú¯Ø²ÛŒÙ†Ù‡ Û±</option>
                        <option value="1">Ú¯Ø²ÛŒÙ†Ù‡ Û²</option>
                        <option value="2">Ú¯Ø²ÛŒÙ†Ù‡ Û³</option>
                        <option value="3">Ú¯Ø²ÛŒÙ†Ù‡ Û´</option>
                    </select>
                </div>`;
            container.insertAdjacentHTML('beforeend', qHTML);
        }

        function generateQuizLink() {
            const title = document.getElementById('quiz-title').value;
            const time = document.getElementById('quiz-time').value;
            if(!title || !time) return alert("Ù„Ø·ÙØ§ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ø²Ù…Ø§Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");

            const qElements = document.querySelectorAll('#questions-container .card');
            const questions = [];

            qElements.forEach(el => {
                const text = el.querySelector('.q-text').value;
                const opts = Array.from(el.querySelectorAll('.q-opt')).map(i => i.value);
                const correct = el.querySelector('.q-correct').value;
                if(text && correct !== "") {
                    questions.push({ t: text, o: opts, c: parseInt(correct) });
                }
            });

            const quizObj = {
                id: Date.now(),
                title: title,
                time: time,
                questions: questions,
                status: 'active'
            };

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù„ÙˆÚ©Ø§Ù„ Ø§Ø¯Ù…ÛŒÙ†
            adminQuizzes.push(quizObj);
            localStorage.setItem('admin_quizzes', JSON.stringify(adminQuizzes));

            const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(quizObj))));
            const fullLink = `${STUDENT_APP_URL}/?data=${encoded}`;
            
            document.getElementById('final-link').innerText = fullLink;
            document.getElementById('link-result').classList.remove('hidden');
            alert("Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ Ùˆ Ø¯Ø± Ù„ÛŒØ³Øª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
        }

        function renderAdminQuizzes() {
            const list = document.getElementById('admin-quiz-list');
            list.innerHTML = adminQuizzes.length === 0 ? '<p style="padding:20px; text-align:center;">Ù‡Ù†ÙˆØ² Ø¢Ø²Ù…ÙˆÙ†ÛŒ Ù†Ø³Ø§Ø®ØªÙ‡â€ŒØ§ÛŒØ¯.</p>' : '';
            
            adminQuizzes.forEach((q, index) => {
                const item = document.createElement('div');
                item.className = 'quiz-item';
                item.innerHTML = `
                    <div>
                        <strong>${q.title}</strong>
                        <span class="status-badge ${q.status === 'active' ? 'status-active' : 'status-closed'}">
                            ${q.status === 'active' ? 'ÙØ¹Ø§Ù„' : 'Ù¾Ø§ÛŒØ§Ù† ÛŒØ§ÙØªÙ‡'}
                        </span>
                        <br><small style="color:var(--sub)">${q.questions.length} Ø³ÙˆØ§Ù„</small>
                    </div>
                    <button class="btn-stop" onclick="toggleQuiz(${index})" style="background:${q.status === 'active' ? '' : '#34C759'}">
                        ${q.status === 'active' ? 'Ù¾Ø§ÛŒØ§Ù† Ø¢Ø²Ù…ÙˆÙ†' : 'ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ'}
                    </button>
                `;
                list.appendChild(item);
            });
        }

        function toggleQuiz(index) {
            adminQuizzes[index].status = adminQuizzes[index].status === 'active' ? 'closed' : 'active';
            localStorage.setItem('admin_quizzes', JSON.stringify(adminQuizzes));
            renderAdminQuizzes();
        }

        function copyLink() {
            const link = document.getElementById('final-link').innerText;
            navigator.clipboard.writeText(link);
            alert("Ù„ÛŒÙ†Ú© Ú©Ù¾ÛŒ Ø´Ø¯!");
        }
    </script>
</body>
</html>
